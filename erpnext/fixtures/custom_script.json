[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Job Applicant",
  "modified": "2021-02-18 13:55:49.711182",
  "name": "Job Applicant-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Applicant', {\n    \n//   first_name(frm){\n// \t   let first=  frm.doc.first_name;\n// \t   let middle= cur_frm.middle_name;\n// \t   let last = cur_frm.last_name;\n// \t   if(!middle)\n// \t   console.log(first)\n// \t    frm.set_value( first+ \" \"+last, 'application_name')\n// \t    console.log(middle)\n\t   \n//   },\n     \n //first_name(frm) {\n // var first = frm.doc.first_name;\n //  console.log(first);\n// },\n \n //middle_name(frm) {\n  //var middle = frm.doc.middle_name;\n   //console.log(middle);\n// },\n \n //last_name(frm) {\n  //var last = frm.doc.last_name;\n   //console.log(last);\n   //var full= first+\" \"+middle+\" \"+last;\n   //frm.set_value(\"applicant_name\",full);\n //},\n\n\napplicant_name(frm){\n    \n    if (!frm.doc.middle_name){\n        var full_name=frm.doc.first_name+\" \"+frm.doc.last_name;\n        frm.set_value(\"applicant_name\",full_name);\n        refresh_field(\"applicant_name\");\n    }\n    else{\n        \n    \n    var full=frm.doc.first_name+\" \"+frm.doc.middle_name+\" \"+frm.doc.last_name;\n    frm.set_value(\"applicant_name\",full);\n    console.log(full);\n    refresh_field(\"applicant_name\");\n}\n},\n \n // var middle = frm.doc.middle_name;\n // var last = frm.doc.last_name;\n // if (!middle){\n   //   console.log(first);\n    //  console.log(middle);\n   //   console.log(last);\n // var full=first+\" \"+last;\n//frm.set_value('applicant_name',full);\n // }\n // else{\n     // console.log(first);\n     // console.log(last);\n   //var full_name=first+\" \"+middle+\" \"+last;\n  // frm.set_value('applicant_name',full_name);\n // }\n \n//},\n   \n\t\n    \n    \n    \n    \n    \n    \n\t/*applicant_name(frm){\n\t    console.log(frm.doc.applicant_name);\n\t  var sentence = frm.doc.applicant_name.toLowerCase();\n\t  for(var i = 0; i< sentence.length; i++){\n         sentence[i] = sentence[i][0].toUpperCase() + sentence[i].slice(1);\n      }\n   \n   frappe.model.set_value(frm.doc.doctype,frm.doc.name,\"applicant_name\",sentence);\n\t},*/\n\t\n\t\n//   var first = frm.doc.first_name;       \n//   var middle = frm.doc.middle_name;    \n\n\t\n\t\n\t\n\t\n\t\n\tcontact_no(frm){\n\t    var pattern1 = /^([0-9]+(\\s+)?(\\-(\\s+)?[0-9]+)*,*)+$/gm;\n        if (!pattern1.test(frm.doc.contact_no))\n                {frm.doc.contact_no = '';\n\t\t\tcur_frm.refresh_field('contact_no');\n\t\t\tfrappe.throw('Enter correct Contact Number');\n\t    }},\n\tinterview(frm) {\n\t\tif (frm.doc.interview) {\n\t\t\treturn frm.call({\n\t\t\t\tmethod: \"get_employee_skill\",\n\t\t\t\tdoc: frm.doc,\n\t\t\t\tcallback: function() {\n\t\t\t\t\trefresh_field('employee_skill_map');\n\t\t\t\t\trefresh_field('total_socre');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tinterview2(frm) {\n\t\tif (frm.doc.interview2) {\n\t\t\treturn frm.call({\n\t\t\t\tmethod: \"get_employee_skill_map\",\n\t\t\t\tdoc: frm.doc,\n\t\t\t\tcallback: function() {\n\t\t\t\t\trefresh_field('employee_skill_map');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tinterview_status(frm){\n        if (frm.doc.interview_status == \"Failed\")\n                {frappe.model.set_value(frm.doc.doctype,frm.doc.name,\"status\",\"Rejected\");\n\t\t\tcur_frm.refresh_field('status');\n\t    }\n\t    else{\n\t        frappe.model.set_value(frm.doc.doctype,frm.doc.name,\"status\",\"Open\");\n\t\t\tcur_frm.refresh_field('status');\n\t    }\n\t},\n\tinterveiew_status2(frm){\n        if (frm.doc.interveiew_status2 == \"Failed\")\n                {frappe.model.set_value(frm.doc.doctype,frm.doc.name,\"status\",\"Rejected\");\n\t\t\tcur_frm.refresh_field('status');\n\t    }\n\t    else{\n\t        frappe.model.set_value(frm.doc.doctype,frm.doc.name,\"status\",\"Selected\");\n\t\t\tcur_frm.refresh_field('status');\n\t    }\n\t},\n\temergency_number(frm){\n\t    var pattern1 = /^([0-9]+(\\s+)?(\\-(\\s+)?[0-9]+)*,*)+$/gm;\n        if (!pattern1.test(frm.doc.emergency_number))\n                {frm.doc.emergency_number = '';\n\t\t\tcur_frm.refresh_field('contact_no');\n\t\t\tfrappe.throw('Enter correct Contact Number');\n\t    }},\n\tdate_of_birth(frm) {\n\t\tvar dateOfBirth=frm.doc.date_of_birth;\n\t\tvar split_dob = dateOfBirth.split(\"-\")\n\t    var year = split_dob[0];\n        var today = new Date();\n        var today_year=today.getFullYear();\n        var age=today_year-year\n        if(age<18){\n            frappe.throw(\"Age must be 18 or more than 18\")\n        }\n\t    frappe.model.set_value(frm.doc.doctype,frm.doc.name,\"age_as_on_date\",age);\n\t},\n\t\n\taadhar(frm){\n\t    var pattern = /^([0-9]+(\\s+)?(\\-(\\s+)?[0-9]+)*,*)+$/gm;\n        if (!pattern.test(frm.doc.aadhar))\n                {frm.doc.aadhar = '';\n\t\t\tcur_frm.refresh_field('aadhar');\n\t\t\tfrappe.throw('Enter correct Aadhar Number');\n\t    }\n\t},\n\tvalidate(frm){\n\t    if (!frm.doc.application_date){\n\t        frm.set_value('application_date', frappe.datetime.get_today())\n\t    }\n\t    if (frm.doc.interview_status == \"Passed\")\n                {frappe.model.set_value(frm.doc.doctype,frm.doc.name,\"status\",\"Open\");\n\t\t\tcur_frm.refresh_field('status');\n\t    }\n\t    if (frm.doc.interveiew_status2 == \"Passed\")\n                {frappe.model.set_value(frm.doc.doctype,frm.doc.name,\"status\",\"Selected\");\n\t\t\tcur_frm.refresh_field('status');\n\t    }\n\t    if (frm.doc.interveiew_status2 == \"Failed\"){\n\t        frappe.model.set_value(frm.doc.doctype,frm.doc.name,\"status\",\"Rejected\");\n\t\t\tcur_frm.refresh_field('status');\n\t    }\n\t    if (frm.doc.aadhar){\n \t\tfrappe.call({\n \t\t\tmethod: \"erpnext.hr.doctype.job_applicant.job_applicant.aadhar_check\",\n \t\t\targs: {\"aadhar\": frm.doc.aadhar},\n\t        callback: function(r) {\n\t\t\t    console.log(r);\n\t\t\t\tif (!r.exe){\n\t\t\t        cur_frm.set_value( \"existing_employee\", r.message[0]);\n\t\t\t        cur_frm.set_value( \"applicant_type\", \"Rejoining\");\n\t\t\t\t}\n\t\t\t}\n \t\t\t\t});\n\t    }\n        \n \t},\n//\t}\n    calculate_total(frm) {\n\t  \tlet goals = frm.doc.employee_skill_map || [];\n\t\tlet total = 0;\n\n\t\tif (goals == []) {\n\t\t\tfrm.set_value('total_score', 0);\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 0; i<goals.length; i++) {\n\t\t\ttotal = flt(total)+flt(goals[i].score_earned)\n\t\t}\n\t\tif (!isNaN(total)) {\n\t\t\tfrm.set_value('total_score', total);\n\t\t\tif (total >= frm.doc.total_socre){\n\t\t\t    frm.set_value('interview_status', 'Passed');\n\t\t\t}\n\t\t\telse{\n\t\t\t    frm.set_value('interview_status', 'Failed');\n\t\t\t}\n\t\t\tfrm.refresh_field('calculate_total');\n\t\t}\n\t},\n    \n\tset_score_earned(frm) {\n\t\tlet goals = frm.doc.employee_skill_map || [];\n\t\tfor (let i = 0; i<goals.length; i++) {\n\t\t\tvar d = locals[goals[i].doctype][goals[i].name];\n\t\t\tif (d.score && d.per_weightage) {\n\t\t\t\td.score_earned = flt(d.per_weightage*d.score, precision(\"score_earned\", d))/100;\n\t\t\t}\n\t\t\telse {\n\t\t\t\td.score_earned = 0;\n\t\t\t}\n\t\t\trefresh_field('score_earned', d.name, 'employee_skill_map');\n\t\t}\n\t\tfrm.trigger('calculate_total');\n\t},\n\tset_score(frm) {\n\t\tlet goals = frm.doc.emplyee_skill_match || [];\n\t\tfor (let i = 0; i<goals.length; i++) {\n\t\t\tvar d = locals[goals[i].doctype][goals[i].name];\n\t\t\tif (d.score && d.per_weightage) {\n\t\t\t\td.score_earned = flt(d.per_weightage*d.score, precision(\"score_earned\", d))/100;\n\t\t\t}\n\t\t\telse {\n\t\t\t\td.score_earned = 0;\n\t\t\t}\n\t\t\trefresh_field('score_earned', d.name, 'emplyee_skill_match');\n\t\t}\n\t\tfrm.trigger('calculate_total_earned');\n\t},\n\tcalculate_total_earned(frm) {\n\t  \tlet goals = frm.doc.emplyee_skill_match || [];\n\t\tlet total = 0;\n\n\t\tif (goals == []) {\n\t\t\tfrm.set_value('total_score', 0);\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 0; i<goals.length; i++) {\n\t\t\ttotal = flt(total)+flt(goals[i].score_earned)\n\t\t}\n\t\tif (!isNaN(total)) {\n\t\t\tfrm.set_value('total_score_2', total);\n\t\t\tif (total >= frm.doc.total_score1 && total > 0){\n\t\t\t    frm.set_value('interveiew_status2', 'Passed');\n\t\t\t}\n\t\t\telse{\n\t\t\t    frm.set_value('interveiew_status2', 'Failed');\n\t\t\t}\n\t\t\tfrm.refresh_field('calculate_total');\n\t\t}\n\t},\n})\n\n\n\nfrappe.ui.form.on('Appraisal Goal', {\n\tscore: function(frm, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tif (flt(d.score) > 5) {\n\t\t\tfrappe.msgprint(__(\"Score must be less than or equal to 5\"));\n\t\t\td.score = 0;\n\t\t\trefresh_field('score', d.name, 'goals');\n\t\t}\n\t\telse {\n\t\t\t    frm.trigger('set_score_earned');\n\t\t        frm.trigger('set_score');\n\t\t}\n\t},\n\tper_weightage: function(frm, cdt, cdn) {\n\t    let total_amount = 0.0;\n\t\tvar tbl = cur_frm.doc.employee_skill_map || [];\n\t\tvar table = cur_frm.doc.emplyee_skill_match || [];\n\t\tfor(var i = 0; i < tbl.length; i++) {\n\t\t\ttotal_amount+=flt(tbl[i].per_weightage)\n\t    }\n\t    for(var i = 0; i < table.length; i++) {\n\t\t\ttotal_amt+=flt(table[i].per_weightage)\n\t    }\n\t    if (total_amount > 100){\n\t        frappe.throw(\"Total weightage assigned should be 100%. It is \"+ total_amount + \"%\")\n\t    }\n\t    if (total_amount){\n\t        frm.trigger('set_score_earned');\n\t    }\n\t    if (total_amt > 100){\n\t        frappe.throw(\"Total weightage assigned should be 100%. It is \"+ total_amt + \"%\")\n\t    }\n\t    if(total_amt){\n\t    frm.trigger('set_score');\n\t    }\n\t},\n\tgoals_remove: function(frm) {\n\t\tfrm.trigger('set_score_earned');\n\t},\n\t\n\t\n\n\t\n\t\n})\n\n\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Employee",
  "modified": "2021-03-11 10:54:05.491855",
  "name": "Employee-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Employee', {\n\taadhar_card_number(frm) {\n\t\tvar pattern = /^([0-9]+(\\s+)?(\\-(\\s+)?[0-9]+)*,*)+$/gm;\n        if (!pattern.test(frm.doc.aadhar_card_number))\n                {frm.doc.aadhar_card_number = '';\n\t\t\tcur_frm.refresh_field('aadhar_card_number');\n\t\t\tfrappe.throw('Enter correct Aadhar Number');\n\t}},\n\t\n\t\n// \tis_personal_account(frm){ \n// \t     console.log(\"person\")\n//     if(frm.doc.is_personal_account==1){ \n//          console.log(\"person2\")\n//          console.log(is_personal_account)\n//         cur_frm.set_value('salary_account',0); \n//     }else{\n//         console.log(salary)\n//         cur_frm.set_value('is_personal_account',frm.doc.is_personal_account==1); \n//     }\n\t    \n// \t}, \n\n\t function(frm){\n\t    var d = frm.doc.is_personal_account;\n\t    if(d.checked==1){\n\t        frm.set_value(\"salary_account\",frm.doc.salary_account.checked=0);\n\t    }\n\t    else{\n\t        frm.set_value(\"is_personal_account\",d.checked=0);\n\t    }\n\t}\n\n\n});\n\n\nfrappe.ui.form.on('Employee',{\n     refresh:function(frm){\n        frm.add_fetch(\"Job Applicant\",\"source_name\",\"referred_employee\");\n    }\n    \n    \n    \n}); \n    \n\n\nfrappe.ui.form.on('Employee',{\n     final_confirmation_date(frm){\n        var da = frm.doc.final_confirmation_date;\n        console.log(da);\n        cur_frm.add_fetch(\"Job offer\", \"offer_date\", \"final_confirmation_date\");\n        frm.set_value(\" final_confirmation_date\",frm.doc.offer_date);\n        \n        \n\t // cur_frm.add_fetch(\"Job Offer\", \"offer_date\", \"scheduled_confirmation_date\");\n\t  //frm.set_value(\"scheduled_confirmation_date\",frm.doc.offer_date);\n    },\n    salutation(frm){\n        //var gen=frm.doc.salutation;\n        if(cur_frm.add_fetch(\"Employee\",\"salutation\",\"Miss\"));\n        frm.set_value(\"gender\",\"Female\");\n    }\n});\n\n// frappe.ui.form.on('Employee',{\n//  salutation(frm) {\n//     if(frm.doc.salutation== Miss){\n//         console.log(miss)\n//         frm.set_value(\"gender\",female);\n// }\n// }\n// });\n\n\n\n\n//frappe.ui.form.on(\"Employee\", \"onload\", function(frm) {\n//frappe.db.get_value(\"Job Offer\", {scheduled_confirmation_date : cur_frm.doc.offer_date },\n//\"scheduled_confirmation_date\", function(data){\n//cur_frm.set_value(\"scheduled_confirmation_date\", data.scheduled_confirmation_date); });\n//});\n\n\n\n/*frappe.ui.form.on('Employee', {\n    refresh(frm) {\n         cur_frm.add_fetch(\"reports_to\",\"reports_to\",\"leave_approver\");\n         frm.set_value('leave_approver',frm.doc.reports_to);\n    \n}\n});*/"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Material Request",
  "modified": "2020-10-07 10:41:25.545666",
  "name": "Material Request-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Material Request', {\n\trefresh(frm) {\n\t\tif (frm.doc.docstatus === 1) {\n\t\t\tfrm.add_custom_button(__('Sales Invoice'), function() {\n\t\t\t\tfrappe.model.open_mapped_doc({\n\t\t\t\t\tmethod: \"erpnext.stock.doctype.delivery_note.delivery_note.make_sales_invoice\",\n\t\t\t\t\tfrm: cur_frm,\n\t\t\t\t})\n\t\t\t}, __('Create'));\n\t\t\tfrm.page.set_inner_btn_group_as_primary(__('Create'));\n\t\t}\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Job Requisition Form",
  "modified": "2020-10-07 14:11:32.634082",
  "name": "Job Recognition Form-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Recognition Form', {\n\trefresh(frm) {\n\t\t// your code here\n\t}\n})\n\nfrappe.ui.form.on('Applicant Table', {\n\tselected_applicant(frm,cdt,cdn) {\n\t\tcalculate_total_applicant(frm, cdt, cdn)\n\t\t\n\t}\n})\n\nlet calculate_total_applicant = function (frm, cdt, cdn){\n\t\tlet total_applicant = 0;\n\t\tvar tbl = cur_frm.doc.no_of_applicant_selected || [];\n\t\tfor(var i = 0; i < tbl.length; i++) {\n\t\t\ttotal_applicant+=flt(tbl[i].selected_applicant)\n\t\t}\n        console.log(total_applicant)\n        if (cur_frm.doc.no_of_required_emp >total_applicant){\n            frm.set_value(\"status\",\"In - Progress\");\n        }\n        else if (cur_frm.doc.no_of_required_emp <= total_applicant){\n            frm.set_value(\"status\",\"Completed\");\n        }\n\t\tfrm.set_value(\"total_selected_applicant\",total_applicant);\n\t\trefresh_field(\"total_selected_applicant\")\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Job Offer",
  "modified": "2021-02-13 15:35:22.645699",
  "name": "Job Offer-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Offer', {\n\temployee_grade(frm) {\n\t\tif (frm.doc.employee_grade) {\n\t\t\treturn frm.call({\n\t\t\t\tmethod: \"get_employee_grade_slab\",\n\t\t\t\tdoc: frm.doc,\n\t\t\t\tcallback: function() {\n\t\t\t\t\trefresh_field('employee_grade_slab');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tsetup(frm){\n\t    frm.set_query('job_requisition_form', () => {\n            return {\n                filters: {'status': ['Not in',['Completed']]}\n            };\n        }),\n        frm.set_query('training_batch', () => {\n            return {\n                filters: {'training_status': ['in',['Not Started']]}\n            };\n        });\n\t}\n});\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Job Opening",
  "modified": "2020-10-12 13:42:30.388054",
  "name": "Job Opening-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": ""
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Training Event",
  "modified": "2021-02-13 15:36:14.192706",
  "name": "Training Event-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Training Event', {\n\ttraining_batch(frm) {\n\t\tif (frm.doc.training_batch) {\n\t\t\treturn frm.call({\n\t\t\t\tmethod: \"get_attendence\",\n\t\t\t\tdoc: frm.doc,\n\t\t\t\tcallback: function() {\n\t\t\t\t\trefresh_field('employees');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Lead",
  "modified": "2021-03-04 13:11:23.418276",
  "name": "Lead-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Lead', {\n    refresh(frm){\n        cur_frm.add_custom_button(__('Click to Call'), () => frm.trigger('call')).addClass(\"btn-success\").css({'color':'green','font-weight': 'bold'});\n        cur_frm.add_custom_button(__('End Call'), () => frm.trigger('end_call')).addClass(\"btn-danger\").css({'color':'black','font-weight': 'bold'});\n        \n    },\n    call(frm) {\n        \n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.erpnext_integrations.ngucc_integration.call\",\n\t\t\targs: {\"doc\":frm.doc}\n\t\n\t\t\t\t});\n\t\t\n\t},\n\tend_call(frm){\n\t    //cur_frm.add_custom_button(__('Click to Call'), () => frm.trigger('call')).addClass(\"btn-success\").css({'color':'green','font-weight': 'bold'});\n\t    //cur_frm.remove_custom_button('End Call');\n\t    frappe.call({\n\t        method:\"erpnext.erpnext_integrations.ngucc_integration.end_call\",\n\t        args:{\"doc\":frm.doc},\n\t        \tcallback: function(r) {\n            if (!r.exc) {\n                // console.log(r.message);\n            }\n        }\n\t    });\n\t},\n\n    clinic_country(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.clinic_state\",\n\t\t\targs: {\"country\":frm.doc.clinic_country},\n\t        callback: function(r) {\n\t           // console.log(r.message);\n\t           cur_frm.set_df_property(\"clinic_state\",\"options\",r.message);\n\t            }\n\t\t\t\t});\t\n\t},\n\tclinic_state(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.clinic_district\",\n\t\t\targs: {\"state\":frm.doc.clinic_state},\n\t        callback: function(r) {\n\t           // console.log(r.message);\n\t           cur_frm.set_df_property(\"clinic_district\",\"options\",r.message);\n\t            }\n\t\t\t\t});\t\n\t},\n\tclinic_district(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.clinic_address\",\n\t\t\targs: {\"state\":frm.doc.clinic_state,\"district\":frm.doc.clinic_district,\"country\":frm.doc.clinic_country},\n\t        callback: function(r) {\n\t            console.log(r.message);\n\t           cur_frm.set_value(\"clinic\",r.message[0]['name']);\n\t           cur_frm.set_value(\"clinic_name\",r.message[0]['clinic_name']);\n\t           cur_frm.set_value(\"clinic_address\",r.message[0]['address']);\n\t           cur_frm.set_value(\"clinic_map\",r.message[0]['map']);\n\t           cur_frm.set_value(\"doctor_id\",r.message[0]['doctor']);\n\t           cur_frm.set_value(\"doctor_name\",r.message[0]['doctor_name']);\n\t           //cur_frm.add_fetch(\"clinic_name\",\"clinic_name\",\"clinic_name\");\n\t            cur_frm.refresh_fields()\n\t        }\n\t\t\t\t});\t\n\t},\n});\n\n\nfrappe.realtime.on('lead_updates', (data) => {\n    var d = new frappe.ui.Dialog({\n\t    title: data,\n\t     fields: [\n        {\n            label: 'Lead Name',\n            fieldname: 'lead_name',\n            fieldtype: 'Read Only',\n            default:cur_frm.doc.lead_name,\n           \n            \n            \n        },\n        {\n            label: 'Email Id',\n            fieldname: 'Email Id',\n            fieldtype: 'Read Only',\n            default:cur_frm.doc.email_id,\n            \n        },\n        {\n            label: 'Status',\n            fieldname: 'Status',\n            fieldtype: 'Read Only',\n            default:cur_frm.doc.status\n            \n        }\n    ],\n\t    \n\t});\n\td.show();\n\tsetTimeout(() => {  d.hide();}, 10000);\n   \n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Interview",
  "modified": "2020-10-21 14:02:58.819483",
  "name": "Interview-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Interview', {\n\tvalidate(frm){\n\t    let total_amount = 0.0;\n\t\tvar tbl = cur_frm.doc.goals || [];\n\t\tfor(var i = 0; i < tbl.length; i++) {\n\t\t\ttotal_amount+=flt(tbl[i].per_weightage)\n\t    }\n\t    if (total_amount > 100){\n\t        frappe.throw(\"Total weightage assigned should be 100%. It is \"+ total_amount + \"%\")\n\t    }\n\t}\n})\n\nfrappe.ui.form.on('Appraisal Goal', {\n\tscore(frm, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tif (flt(d.score) > 5) {\n\t\t\tfrappe.msgprint(__(\"Score must be less than or equal to 5\"));\n\t\t\td.score = 0;\n\t\t\trefresh_field('score', d.name, 'goals');\n\t\t}\n\t\telse {\n\t\t\tfrm.trigger('set_score_earned');\n\t\t}\n\t},\n\tper_weightage(frm, cdt, cdn) {\n\t    let total_amount = 0.0;\n\t\tvar tbl = cur_frm.doc.goals || [];\n\t\tfor(var i = 0; i < tbl.length; i++) {\n\t\t\ttotal_amount+=flt(tbl[i].per_weightage)\n\t    }\n\t    if (total_amount > 100){\n\t        frappe.throw(\"Total weightage assigned should be 100%. It is \"+ total_amount + \"%\")\n\t    }\n\t\t}\n\t\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "New Enquiry",
  "modified": "2021-02-20 14:48:34.827857",
  "name": "New Enquiry-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('New Enquiry', {\n    validate(frm){\n       frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.existing_lead\",\n\t\t\targs: {\"doc\":frm.doc},\n            \n\t\t\t\t}); \n    },\n\tafter_save(frm) {\n\t    frappe.call({\n\t        \"method\":\"erpnext.crm.doctype.new_enquiry.new_enquiry.page_refresh\"\n\t    })\n\t   // return frappe.ui.toolbar.clear_cache();\n// \t\tfrappe.call({\n// \t\t\tmethod: \"erpnext.crm.doctype.lead.lead.end_call\",\n// \t\t\targs: {\"agent_id\":frm.doc.agent_name,\"disposition\":frm.doc.disposition1,\"time\":frm.doc.callback_date}\n\t\n\t\t\t\t// });\n\n\t},\n\tmobile_number(frm) {\n\t    var pattern1 = /^([0-9]+(\\s+)?(\\-(\\s+)?[0-9]+)*,*)+$/gm;\n        if (!pattern1.test(frm.doc.mobile_number))\n                {frm.doc.mobile_number = '';\n\t\t\tcur_frm.refresh_field('mobile_number');\n\t\t\tfrappe.throw('Enter correct Mobile Number');\n\t    }\n\t    if(frm.doc.mobile_number.length > 10 || frm.doc.mobile_number.length < 10){ \n\t\t        //frappe.web_form.set_value(\"mobile\", '0')\n\t\t        frm.doc.mobile_number = '';\n\t\t        cur_frm.refresh_field('mobile_number');\n                frappe.throw(\"Enter correct Mobile Number\");\n        }\n\t    frappe.call({\n\t        method:\"erpnext.crm.doctype.new_enquiry.new_enquiry.fetch_pincode\"\n\t    });\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.exist_lead\",\n\t\t\targs: {\"mobile\":frm.doc.mobile_number},\n\t\t\tcallback: function(r){\n                // console.log(r.message);\n                    if (r.message){\n                        console.log(r.message[0]);\n\n                        cur_frm.set_value(\"name1\",r.message[0]['lead_name']);\n                        cur_frm.set_value(\"age\",r.message[0]['age']);\n                        cur_frm.set_value(\"blood_group\",r.message[0]['blood_group']);\n                        cur_frm.set_value(\"gender\",r.message[0]['gender']);\n                        cur_frm.set_value(\"name1\",r.message[0]['lead_name']);\n                        cur_frm.set_value(\"diseases\",r.message[0]['diseases']);\n                        cur_frm.set_value(\"how_many_years\",r.message[0]['years']);\n                        \n                    }\n            }\t\n\t\n\t\t\t\t});\n\t\tfrappe.call({\n\t\t  \n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.get_general_enquiry\",\n\t\t\targs: {\"mobile\":frm.doc.mobile_number},\n\t\t\tcallback: function(r){\n\t\t\t    if(!r.exc){\n\t\t\t        console.log(r.message)\n\t\t\t var template = `<table style=\"font-family: arial, sans-serif;border-collapse: collapse;width: 100%;\"><tbody>\n\t\t\t <tr>\n\t\t\t <th style=\"text-align:center;border: 1px solid #dddddd; \" >Name </th>\n\t\t\t <th style=\"text-align:center;border: 1px solid #dddddd;\" >Phone</th>\n\t\t\t <th style=\"text-align:center;border: 1px solid #dddddd;\" >Query Category</th>\n\t\t\t <th style=\"text-align:center;border: 1px solid #dddddd;\" >Query Type</th>\n\t\t\t <th style=\"text-align:center;border: 1px solid #dddddd;\" >Schedule Date</th>\n\t\t\t <th style=\"text-align:center;border: 1px solid #dddddd; width:200px;\" >Query Description</th>\n\t\t\t </tr>\n\t  \n\t  {% for row in rows %}\n\t\t\t  <tr>\n\t\t\t  <td style=\"border: 1px solid #dddddd;\">{{ row.name}}</td>\n\t\t\t  <td style=\"border: 1px solid #dddddd;\">{{ row.mobile_no}}</td>\n\t\t\t  <td style=\"border: 1px solid #dddddd;\">{{row.query_category }}</td>\n\t\t\t  <td style=\"border: 1px solid #dddddd;\">{{row.query_type }}</td>\n\t\t\t  <td style=\"border: 1px solid #dddddd;\">{{row.schedule_date }}</td>\n\t\t\t  <td style=\"border: 1px solid #dddddd;\">{{row.query_description}}</td>\n\t\t\t  </tr>\n\t\t{% endfor %}\t \n\t\t\t \n\t\t\t\n\t\t\t </tbody></table>`\n\t\t\t frm.set_df_property(\"history\",'options', frappe.render(template, {rows: r.message}));\n\t\t\t frm.refresh_field('history');\n                //$(frm.fields_dict['history'].wrapper).html(data);\n\t\t\t    }\n\t\t\t}\n\t\t    \n\t\t});\n\t},\n\tonload(frm){\n\t   // console.log(frappe.session)\n\t    frm.set_value(\"agent_name\", frappe.session.user_fullname)\n\t    \n\t},\n\tclinic_country(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.clinic_state\",\n\t\t\targs: {\"country\":frm.doc.clinic_country},\n\t        callback: function(r) {\n\t           // console.log(r.message);\n\t           cur_frm.set_df_property(\"clinic_state\",\"options\",r.message);\n\t            }\n\t\t\t\t});\t\n\t},\n\tclinic_state(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.clinic_district\",\n\t\t\targs: {\"state\":frm.doc.clinic_state},\n\t        callback: function(r) {\n\t           // console.log(r.message);\n\t           cur_frm.set_df_property(\"clinic_district\",\"options\",r.message);\n\t            }\n\t\t\t\t});\t\n\t},\n\tclinic_district(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.clinic_address\",\n\t\t\targs: {\"state\":frm.doc.clinic_state,\"district\":frm.doc.clinic_district,\"country\":frm.doc.clinic_country},\n\t        callback: function(r) {\n\t            console.log(r.message);\n\t           cur_frm.set_value(\"clinic\",r.message[0]['name']);\n\t           cur_frm.set_value(\"clinic_name\",r.message[0]['clinic_name']);\n\t           cur_frm.set_value(\"clinic_address\",r.message[0]['address']);\n\t           cur_frm.set_value(\"clinic_map\",r.message[0]['map']);\n\t           cur_frm.set_value(\"doctor_id\",r.message[0]['doctor']);\n\t           cur_frm.set_value(\"doctor_name\",r.message[0]['doctor_name']);\n\t           //cur_frm.add_fetch(\"clinic_name\",\"clinic_name\",\"clinic_name\");\n\t            cur_frm.refresh_fields()\n\t        }\n\t\t\t\t});\t\n\t},\n\tstate(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.search\",\n\t\t\targs: {\"state\":frm.doc.state},\n\t        callback: function(r) {\n\t           // console.log(r.message);\n\t           cur_frm.set_df_property(\"district\",\"options\",r.message);\n\t            }\n\t\t\t\t});\t\n\t},\n\t\tdistrict(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.search_tehsil\",\n\t\t\targs: {\"district\":frm.doc.district},\n\t        callback: function(r) {\n\t            //if (r.message.length>1){\n\t            console.log(r.message);\n\t           cur_frm.set_df_property(\"tehsil\",\"options\",r.message);\n\t            //}\n\t           // else{\n\t           //     console.log(r.message[0]);\n\t           //     cur_frm.set_df_property(\"tehsil\",\"options\",r.message);\n\t           //      //cur_frm.set_value(\"tehsil\",r.message[0]);\n\t           //      }\n\t        }\n\t\t\t\t});\t\n\t},\n\t\ttehsil(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.search_city\",\n\t\t\targs: {\"tehsil\":frm.doc.tehsil},\n\t        callback: function(r) {\n\t            console.log(r.message);\n\t           cur_frm.set_df_property(\"city1\",\"options\",r.message);\n\t            }\n\t\t\t\t});\t\n\t},\n\t\tcity1(frm) {\n\t\t    if (frm.doc.city1!=\"NA\")\n    {\t\t  \n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.search_pincode\",\n\t\t\targs: {\"city\":frm.doc.city1},\n\t        callback: function(r) {\n\t           // console.log(r.message);\n\t           cur_frm.set_value(\"pincode\",r.message);\n\t            }\n\t\t\t\t});\t\n    }\n        \n    },\n    // query_type(frm){\n    //   if (frm.doc.query_type == \"Clinic Query\"){\n    //       window.open('https://clinics.shuddhi.com/', '_blank')\n    //   }  \n    // },\n    query_category(frm){\n    if(frm.doc.query_category == \"Product Purchase\"){\n        frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.get_standard_item\",\n\t\t\tcallback: function(r){\n\t\t\t    if(r.message){\n\t\t\t        console.log(r.message)\n\t\t\t        let message_body = r.message;\n\t\t\t        frm.doc.items = []\n\t\t\t        for (var i in message_body){\n\t\t\t            frm.add_child(\"items\");\n\t\t\t            frm.fields_dict.items.get_value()[i].item_code = message_body[i].item_code;\n\t\t\t            frm.fields_dict.items.get_value()[i].item_name = message_body[i].item_name;\n\t\t\t            frm.fields_dict.items.get_value()[i].price_list_rate = message_body[i].price_list;\n\t\t\t            frm.fields_dict.items.get_value()[i].amount = message_body[i].price_list;\n\t\t\t            frm.fields_dict.items.get_value()[i].total_amount = message_body[i].price_list;\n\t\t\t            frm.fields_dict.items.get_value()[i].qty = 1;\n\t\t\t        }\n\t\t\t        calculate_total_amount(frm)\n\t\t\t        frm.refresh();\n\t\t\t        //frm.refresh_fields(\"items\")\n\t\t\t    }\n\t\t\t}\n\t\t\t\n        })\n    }\n    // if(frm.doc.query_category == \"Appointment for Clinic\"){\n    //     window.open('https://clinics.shuddhi.com/', '_blank')\n    // }\n    }\n})\nfrappe.ui.form.on('New Enquiry Item', {\nitem_code(frm,cdt,cdn){\n     var d = frappe.model.get_doc(cdt, cdn);\n     if(d.item_code){\n         console.log(\"inn\")\n    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.get_item_price\",\n\t\t\targs: {\"item\":d.item_code},\n\t        callback: function(r) {\n\t            console.log(r.message);\n\t            let price = r.message[0]\n\t            frappe.model.set_value(cdt, cdn, \"price_list_rate\", flt(price));\n\t            frappe.model.set_value(cdt, cdn, \"amount\", flt(price));\n\t            frappe.model.set_value(cdt, cdn, \"qty\", 1);\n\t            }\n\t\t\t\t});\t\n    }\n},\n    qty(frm,cdt,cdn){\n    var d = frappe.model.get_doc(cdt, cdn);\n     if(d.qty && d.amount){\n     var rate = (d.amount * d.qty)\n     frappe.model.set_value(cdt, cdn, \"total_amount\", rate);    \n     }\n},\n    total_amount(frm, cdt, cdn) { \n        calculate_total_amount(frm, cdt, cdn)\n    },\n    items_remove(frm, cdt, cdn) { \n        calculate_total_amount(frm, cdt, cdn)\n    },\n});\n\n\nlet calculate_total_amount = function (frm, cdt, cdn){\n\t\tlet total_amount = 0.0;\n\t\tvar tbl = cur_frm.doc.items || [];\n\t\tfor(var i = 0; i < tbl.length; i++) {\n\t\t\ttotal_amount+=flt(tbl[i].total_amount)\n\t\t}\n\n\t\tfrm.set_value(\"total\",total_amount);\n\t\t//var grand_total = (total_amount + frm.doc.gst)\n\t    //frm.set_value(\"grand_total\",grand_total);\n\t\trefresh_field(\"total\")\n\t\t//refresh_field(\"grand_total\")\n};\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Update Employee",
  "modified": "2021-01-18 10:54:39.583474",
  "name": "Update Employee-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Update Employee', {\n\trefresh(frm) {\n\t\t// your code here\n\t\tsetup: function(frm) {\n\t\tfrm.set_query(\"employee\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\t\"status\": \"Active\"\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t},\n\t\n\tonload: function(frm){\n\t\tif(frm.doc.__islocal){\n\t\t\tif(frm.doctype == \"Employee Promotion\"){\n\t\t\t\tfrm.doc.promotion_details = [];\n\t\t\t}else if (frm.doctype == \"Employee Transfer\") {\n\t\t\t\tfrm.doc.transfer_details = [];\n\t\t\t}\n\t\t}\n\t},\n\t\n\temployee: function(frm) {\n\t\tfrm.add_fetch(\"employee\", \"company\", \"company\");\n\t},\n\trefresh: function(frm) {\n\t\tvar table;\n\t\tif(frm.doctype == \"Employee Promotion\"){\n\t\t\ttable = \"promotion_details\";\n\t\t}else if (frm.doctype == \"Employee Transfer\") {\n\t\t\ttable = \"transfer_details\";\n\t\t}\n\t\tif(!table){return;}\n\t\tcur_frm.fields_dict[table].grid.wrapper.find('.grid-add-row').hide();\n\t\tcur_frm.fields_dict[table].grid.add_custom_button(__('Add Row'), () => {\n\t\t\tif(!frm.doc.employee){\n\t\t\t\tfrappe.msgprint(__(\"Please select Employee\"));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'erpnext.hr.utils.get_employee_fields_label',\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message){\n\t\t\t\t\t\tshow_dialog(frm, table, r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n\n\t\t\n\t\t\n\t\t\n\t\t\n\t\t\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Employee Referral",
  "modified": "2021-02-02 14:19:08.675532",
  "name": "Employee Referral-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Employee Referral', {\n\trefresh(frm) {\n\t\t// your code here\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Appointment",
  "modified": "2021-03-04 12:11:46.463888",
  "name": "Appointment-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Appointment', {\n\trefresh(frm){\n        cur_frm.add_custom_button(__('Sales Invoice'), () => frm.trigger('sales_invoice'));\n    },\n    sales_invoice(frm){\n        frappe.route_options = { \"customer\":cur_frm.doc.customer_name}\n        frappe.set_route(\"Form\",\"Sales Invoice\",\"New Sales Invoice\")\n    },\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Address",
  "modified": "2021-03-02 17:35:12.116037",
  "name": "Address-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Address', {\n\tvalidate(frm) {\n\t\tcur_frm.set_value(\"pincode\",frm.doc.pincode1);\n\t},\n\tstate(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.search\",\n\t\t\targs: {\"state\":frm.doc.state},\n\t        callback: function(r) {\n\t           // console.log(r.message);\n\t           cur_frm.set_df_property(\"city\",\"options\",r.message);\n\t            }\n\t\t\t\t});\t\n\t},\n\tcity(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.search_tehsil\",\n\t\t\targs: {\"district\":frm.doc.city},\n\t        callback: function(r) {\n\t            //if (r.message.length>1){\n\t           // console.log(r.message);\n\t           cur_frm.set_df_property(\"tehsil\",\"options\",r.message);\n\t        }\n\t\t\t\t});\t\n\t},\n\ttehsil(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.search_city\",\n\t\t\targs: {\"tehsil\":frm.doc.tehsil},\n\t        callback: function(r) {\n\t           // console.log(r.message);\n\t           cur_frm.set_df_property(\"area\",\"options\",r.message);\n\t            }\n\t\t\t\t});\t\n\t},\n\tarea(frm) {\n\t\t    if (frm.doc.area!=\"NA\")\n    {\t\t  \n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.search_pincode\",\n\t\t\targs: {\"city\":frm.doc.area},\n\t        callback: function(r) {\n\t           // console.log(r.message);\n\t           cur_frm.set_value(\"pincode1\",r.message);\n\t            }\n\t\t\t\t});\t\n    }\n        \n    },\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Opportunity",
  "modified": "2021-03-04 16:18:16.211554",
  "name": "Opportunity-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Opportunity', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\tdiscount_amount(frm){\n\t    frm.set_value(\"opportunity_amount\",frm.doc.total-frm.doc.discount_amount)\n\t},\n\tproduct(frm){\n\t    if (cur_frm.doc.product){\n        var d = new frappe.ui.Dialog({\n\t    title: \"Product Info\",\n\t     fields: [\n        {\n            label: 'Product Description',\n            fieldname: 'product_description',\n            fieldtype: 'Read Only',\n            default:cur_frm.doc.product_description,\n           \n            \n            \n        }\n    ],\n\t    \n\t});\n\td.show();\n\tsetTimeout(() => {  d.hide();}, 10000);\n\t    }\n    },\n\twith_items(frm){\n\t    if(frm.doc.with_items==1){\n\t        frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.get_standard_item\",\n\t\t\tcallback: function(r){\n\t\t\t    if(r.message){\n\t\t\t        console.log(r.message)\n\t\t\t        let message_body = r.message;\n\t\t\t        frm.doc.items = []\n\t\t\t        for (var i in message_body){\n\t\t\t            frm.add_child(\"items\");\n\t\t\t            frm.fields_dict.items.get_value()[i].item_code = message_body[i].item_code;\n\t\t\t            frm.fields_dict.items.get_value()[i].item_name = message_body[i].item_name;\n\t\t\t            frm.fields_dict.items.get_value()[i].price_list_rate = message_body[i].price_list;\n\t\t\t            frm.fields_dict.items.get_value()[i].amount = message_body[i].price_list;\n\t\t\t            frm.fields_dict.items.get_value()[i].rate = message_body[i].price_list;\n\t\t\t            frm.fields_dict.items.get_value()[i].total_amount = message_body[i].price_list;\n\t\t\t            frm.fields_dict.items.get_value()[i].qty = 1;\n\t\t\t        }\n\t\t\t        calculate_total_amount(frm)\n\t\t\t        //frm.refresh();\n\t\t\t        frm.refresh_fields(\"items\")\n\t\t\t    }\n\t\t\t}\n\t\t\t\n        })\n    }\n\t},\n\tclinic_country(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.clinic_state\",\n\t\t\targs: {\"country\":frm.doc.clinic_country},\n\t        callback: function(r) {\n\t           // console.log(r.message);\n\t           cur_frm.set_df_property(\"clinic_state\",\"options\",r.message);\n\t            }\n\t\t\t\t});\t\n\t},\n\tclinic_state(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.clinic_district\",\n\t\t\targs: {\"state\":frm.doc.clinic_state},\n\t        callback: function(r) {\n\t           // console.log(r.message);\n\t           cur_frm.set_df_property(\"clinic_district\",\"options\",r.message);\n\t            }\n\t\t\t\t});\t\n\t},\n\tclinic_district(frm) {\n\t    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.clinic_address\",\n\t\t\targs: {\"state\":frm.doc.clinic_state,\"district\":frm.doc.clinic_district,\"country\":frm.doc.clinic_country},\n\t        callback: function(r) {\n\t            console.log(r.message);\n\t           cur_frm.set_value(\"clinic\",r.message[0]['name']);\n\t           cur_frm.set_value(\"clinic_name\",r.message[0]['clinic_name']);\n\t           cur_frm.set_value(\"clinic_address\",r.message[0]['address']);\n\t           cur_frm.set_value(\"clinic_map\",r.message[0]['map']);\n\t           cur_frm.set_value(\"doctor_id\",r.message[0]['doctor']);\n\t           cur_frm.set_value(\"doctor_name\",r.message[0]['doctor_name']);\n\t           //cur_frm.add_fetch(\"clinic_name\",\"clinic_name\",\"clinic_name\");\n\t            cur_frm.refresh_fields()\n\t        }\n\t\t\t\t});\t\n\t}\n\t\n})\nfrappe.ui.form.on('Opportunity Item', {\nitem_code(frm,cdt,cdn){\n     var d = frappe.model.get_doc(cdt, cdn);\n     if(d.item_code){\n         console.log(\"inn\")\n    frappe.call({\n\t\t\tmethod: \"erpnext.crm.doctype.new_enquiry.new_enquiry.get_item_price\",\n\t\t\targs: {\"item\":d.item_code},\n\t        callback: function(r) {\n\t            console.log(r.message);\n\t            let price = r.message[0]\n\t            frappe.model.set_value(cdt, cdn, \"price_list_rate\", flt(price));\n\t            frappe.model.set_value(cdt, cdn, \"amount\", flt(price));\n\t            frappe.model.set_value(cdt, cdn, \"qty\", 1);\n\t            }\n\t\t\t\t});\t\n    }\n},\n    qty(frm,cdt,cdn){\n    var d = frappe.model.get_doc(cdt, cdn);\n     if(d.qty && d.amount){\n     var rate = (d.amount * d.qty)\n     frappe.model.set_value(cdt, cdn, \"total_amount\", rate);    \n     }\n},\n    total_amount(frm, cdt, cdn) { \n        calculate_total_amount(frm, cdt, cdn)\n    },\n    items_remove(frm, cdt, cdn) { \n        calculate_total_amount(frm, cdt, cdn)\n    }\n});\n\n\nlet calculate_total_amount = function (frm, cdt, cdn){\n\t\tlet total_amount = 0.0;\n\t\tvar tbl = cur_frm.doc.items || [];\n\t\tfor(var i = 0; i < tbl.length; i++) {\n\t\t\ttotal_amount+=flt(tbl[i].total_amount)\n\t\t}\n\n\t\tfrm.set_value(\"total\",total_amount);\n\t\trefresh_field(\"total\")\n};"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Sales Order",
  "modified": "2021-03-03 16:50:22.143877",
  "name": "Sales Order-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Sales Order', {\n\tvalidate(frm) {\n\t    console.log(frm.doc.status)\n\t\tif (frm.doc.status == \"Draft\"){\n\t\t      cur_frm.set_value(\"status\",\"Address Verification\")\n\t\t      cur_frm.refresh_field(\"status\")\n\t\t}\n\t}\n})"
 }
]